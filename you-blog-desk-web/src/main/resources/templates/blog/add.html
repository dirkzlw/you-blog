<!doctype html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/blog/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="/blog/css/main.css" media="all">
    <link rel="stylesheet" href="/blog/css/animate.css">
    <link rel="stylesheet" href="/blog/css/font-icon.css">
    <title>ä¸ªäººåšå®¢</title>
</head>
<body>
<!--å¤´éƒ¨-->
<div th:replace="~{fragments/header :: header}"></div>

<!--å†…å®¹-->
<div class="container mt-3">
    <div class="row">
        <div class="col-lg-10 offset-lg-1 col-md-10 offset-md-1">
            <table align="center" border="0px" style="width: 100%">
                <tr align="center" style="width: 99%">
                    <td colspan="3">
                        <div>
                            <input style="width: 100%;height: 35px"
                                   type="text"
                                   id="title" maxlength="50"
                                   name="title" placeholder=" è¾“å…¥æ–‡ç« æ ‡é¢˜ (é™50å­—) ">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="height: 15px"></td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div id="editor">
                            <!--<p id="info"></p>-->
                        </div>
                    </td>
                </tr>
                <!--å¯Œæ–‡æœ¬ç¼–è¾‘å™¨wangEditor-->
                <tr>
                    <td colspan="3">
                        <textarea id="textEditor" style="display: none" name="text"></textarea>
                    </td>
                </tr>
                <tr>
                    <td style="height: 15px"></td>
                </tr>
                <!--æ ‡ç­¾-->
                <tr>
                    <td colspan="3">
                        æ–‡ç« ç±»å‹ï¼š
                        <select name="artType">
                            <option>è¯·é€‰æ‹©</option>
                            <option value="1">åŸåˆ›</option>
                            <option value="2">è½¬å‘</option>
                            <option value="3">ç¿»è¯‘</option>
                        </select>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        åšå®¢æ ‡ç­¾ï¼š
                        <select name="tagId">
                            <option>è¯·é€‰æ‹©</option>
                            <option th:each="tag : ${tagList}" th:value="${tag.tagId}"
                                    th:text="${tag.type}"></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="height: 20px"></td>
                </tr>
                <!--å°é¢-->
                <tr>
                    <td colspan="3">
                        æ–‡ç« å°é¢ï¼š
                        <input id="coverImg"
                               type="file" accept="image/*" name="coverImg"
                               style="display: none;"
                               onchange="preImg(this.id,'imgPre');">

                        <!--è§¦å‘<input type="file"/>-->
                        <input type="button" style="color: black;cursor: pointer"
                               value="é€‰æ‹©å°é¢"
                               onclick="document.getElementById('coverImg').click()"/>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        å°é¢é¢„è§ˆï¼š
                        <img id="imgPre" style="width: 169.5px;height: 105px;" src="/blog/images/eg.png"
                             title="æ–‡ç« å°é¢é¢„è§ˆ">
                    </td>

                </tr>

                <tr>
                    <td style="height: 28px"></td>
                </tr>
                <tr>
                    <td>
                        <input type="submit" class="btn btn-block btn-danger"
                               style="text-align: center;width: 80%;cursor: pointer;font-size: 20px"
                               value="å‘å¸ƒåšå®¢" onclick="checkSubmit()">
                    </td>
                    <td>
                        <a href="/"><input class="btn btn-block btn-info"
                                           style="text-align: center;width: 40%;cursor: pointer;font-size: 20px"
                                           value="å–æ¶ˆç¼–è¾‘"></a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

<!--åº•éƒ¨-->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="/blog/lib/jquery/jquery.js"></script>
<script src="/blog/lib/bootstrap/js/bootstrap.js"></script>
<!--åŠ è½½wangEditorå¯Œæ–‡æœ¬ç¼–è¾‘å™¨-->
<script type="text/javascript" charset="utf-8" src="/wangEditor/wangEditor.min.js"></script>
<!--layui-->
<script src="/layui/layui.js" charset="utf-8"></script>
<!--ä¿®æ”¹å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ ·å¼-->
<script type="text/javascript">

    //æ·»åŠ å¼¹å‡ºå±‚
    layui.use(['layer'], function () {
        $ = layui.jquery;//jquery
        layer = layui.layer;//å¼¹å‡ºå±‚

    });

    var E = window.wangEditor;
    var editor = new E(document.getElementById('editor'));
    //è·å–æ–‡æœ¬åŸŸ
    var $textEditor = $('#textEditor');
    editor.customConfig.onchange = function (html) {
        // ç›‘æ§å˜åŒ–ï¼ŒåŒæ­¥æ›´æ–°åˆ° textarea
        $textEditor.val(html)
    };

    //å…³é—­è¿‡æ»¤æ ·å¼
    editor.customConfig.pasteFilterStyle = false;
    // å¿½ç•¥ç²˜è´´å†…å®¹ä¸­çš„å›¾ç‰‡
    editor.customConfig.pasteIgnoreImg = true;

    // è‡ªå®šä¹‰èœå•é…ç½®
    editor.customConfig.menus = [
        'head',  // æ ‡é¢˜
        'bold',  // ç²—ä½“
        'fontSize',  // å­—å·
        'fontName',  // å­—ä½“
        'italic',  // æ–œä½“
        'underline',  // ä¸‹åˆ’çº¿
        'strikeThrough',  // åˆ é™¤çº¿
        'foreColor',  // æ–‡å­—é¢œè‰²
        'quote',  // å¼•ç”¨
        // 'video',  // æ’å…¥è§†é¢‘
        'backColor',  // èƒŒæ™¯é¢œè‰²
        'link',  // æ’å…¥é“¾æ¥
        'code',  // æ’å…¥ä»£ç 
        'list',  // åˆ—è¡¨
        'justify',  // å¯¹é½æ–¹å¼
        'emoticon',  // è¡¨æƒ…
        'image',  // æ’å…¥å›¾ç‰‡
        'table',  // è¡¨æ ¼
        'undo',  // æ’¤é”€
        'redo'  // é‡å¤
    ];
    // è‡ªå®šä¹‰é…ç½®é¢œè‰²ï¼ˆå­—ä½“é¢œè‰²ã€èƒŒæ™¯è‰²ï¼‰
    editor.customConfig.colors = [
        '#c22525',
        '#f9963b',
        '#8baa4a',
        '#46acc8',
        '#4d80bf',
        '#7b5ba1',
        '#1c487f',
        '#ffffff',
        '#000000'
    ];
    // è¡¨æƒ…é¢æ¿å¯ä»¥æœ‰å¤šä¸ª tab ï¼Œå› æ­¤è¦é…ç½®æˆä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ª tab çš„é…ç½®
    editor.customConfig.emotions = [
        {
            // tab çš„æ ‡é¢˜
            title: 'emoji',
            // type -> 'emoji' / 'image'
            type: 'emoji',
            // content -> æ•°ç»„
            content: ['ğŸ˜‚', 'ğŸ˜…', 'ğŸ˜', 'ğŸ˜ ', 'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜†', 'ğŸ˜‰', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ˜¡',
                'ğŸ˜®', 'ğŸ˜¥', 'ğŸ˜¨', 'ğŸ˜Ÿ', 'ğŸ˜³', 'ğŸ˜¢', 'ğŸ˜£', 'ğŸ˜¦', 'ğŸ˜©', 'ğŸ˜±', 'ğŸ˜µ', 'ğŸ˜´',
                'ğŸ˜¤', 'ğŸ˜§', 'ğŸ˜°', 'ğŸ˜²', 'ğŸ˜¶', 'ğŸ˜·', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜–', 'ğŸ˜', 'ğŸ˜›', 'ğŸ˜‹',
                'ğŸ˜˜', 'ğŸ˜­', 'ğŸ˜”', 'ğŸ˜’', 'ğŸ˜œ', 'ğŸ¤‘', 'ğŸ¤£', 'ğŸ¤¯', 'ğŸ‘¿', 'ğŸ¤¬', 'ğŸ’©', 'ğŸ’€ ',
                'ğŸ’‹']
        }
    ];
    //å›¾ç‰‡ä¸Šä¼ åœ°å€çš„URL
    editor.customConfig.uploadImgServer = '/blog/img/upload'; //ä¸Šä¼ URL
    //å›¾ç‰‡å¤§å°é™åˆ¶ä¸º3Mï¼Œé»˜è®¤æ˜¯5M
    // editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024;
    //ä¸Šä¼ å›¾ç‰‡æ•°é‡é»˜è®¤10000å¼ 
    // editor.customConfig.uploadImgMaxLength = 5;
    // ä¸Šä¼ æ–‡ä»¶çš„åå­—
    editor.customConfig.uploadFileName = 'file';
    editor.customConfig.uploadImgHooks = {
        customInsert: function (insertImg, result, editor) {
            // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›ç»“æœï¼Œè‡ªå®šä¹‰æ’å…¥å›¾ç‰‡çš„äº‹ä»¶ï¼ˆè€Œä¸æ˜¯ç¼–è¾‘å™¨è‡ªåŠ¨æ’å…¥å›¾ç‰‡ï¼ï¼ï¼ï¼‰
            // insertImg æ˜¯æ’å…¥å›¾ç‰‡çš„å‡½æ•°ï¼Œeditor æ˜¯ç¼–è¾‘å™¨å¯¹è±¡ï¼Œresult æ˜¯æœåŠ¡å™¨ç«¯è¿”å›çš„ç»“æœ

            // ä¸¾ä¾‹ï¼šå‡å¦‚ä¸Šä¼ å›¾ç‰‡æˆåŠŸåï¼ŒæœåŠ¡å™¨ç«¯è¿”å›çš„æ˜¯ {url:'....'} è¿™ç§æ ¼å¼ï¼Œå³å¯è¿™æ ·æ’å…¥å›¾ç‰‡ï¼š
            var url = result.data;
            insertImg(url);

            // result å¿…é¡»æ˜¯ä¸€ä¸ª JSON æ ¼å¼å­—ç¬¦ä¸²ï¼ï¼ï¼å¦åˆ™æŠ¥é”™
        }
    };
    //è‡ªå®šä¹‰æç¤º
    editor.customConfig.customAlert = function (info) {
        layer.msg(info, {icon: 5, time: 1000});
    };

    editor.create()
</script>
<script type="text/javascript">

    //æ–‡ç« æ ‡é¢˜è·å–å…‰æ ‡
    window.onload = function () {
        var titInput = document.getElementById("title");
        titInput.focus();
        //ç¬¬ä¸€æ­¥æ˜¯å…ˆè·å–æœåŠ¡å™¨ä¼ è¿‡æ¥çš„å›¾æ–‡ä¿¡æ¯å€¼
        // var info1 = document.getElementById("info").textContent;
        //æŠŠå›¾æ–‡ä¿¡æ¯çš„å€¼é€šè¿‡innerHTMLèµ‹å€¼ç»™ç¼–è¾‘å™¨
        // document.getElementById("info").innerHTML = info1;

        // ç›‘æ§å˜åŒ–ï¼ŒåŒæ­¥æ›´æ–°åˆ° textarea
        // $('#textEditor').val(info1)
    };

    /**
     * è¡¨å•æäº¤ä¹‹å‰è¿›è¡ŒéªŒè¯
     */
    function checkSubmit() {
        var title = $("#title").val().trim();
        if (title == "") {
            layer.msg("æ ‡é¢˜ä¸èƒ½ä¸ºç©ºï¼", {icon: 5, time: 1000});
            return false;
        }
        var content = $("#textEditor").val().trim();
        if (content == "") {
            layer.msg("åšå®¢å†…å®¹ä¸èƒ½ä¸ºç©ºï¼", {icon: 5, time: 1000});
            return false;
        }
        var artType = document.getElementsByName("artType")[0].value;
        if (artType == "è¯·é€‰æ‹©") {
            layer.msg("è¯·é€‰æ‹©åšå®¢ç±»å‹ï¼", {icon: 5, time: 1000});
            return false;
        }
        var tagId = document.getElementsByName("tagId")[0].value;
        if (tagId == "è¯·é€‰æ‹©") {
            layer.msg("è¯·é€‰æ‹©åšå®¢æ ‡ç­¾ï¼", {icon: 5, time: 1000});
            return false;
        }
        var imgSrc = $('#coverImg').val();
        if (imgSrc == "") {
            layer.msg("è¯·é€‰æ‹©åšå®¢å°é¢ï¼", {icon: 5, time: 1000});
            return false;
        }
        var text = editor.txt.text();
        if (text.toLocaleString().length > 100) {
            text = text.toLocaleString().substr(0, 100).replace("&nbsp;", "");
        } else {
            while (text.toLocaleString().length < 30) {
                text = text + "#";
            }
        }
        var formData = new FormData();
        var coverImg = document.getElementById("coverImg").files[0];
        formData.append("title", title);
        formData.append("content", content);
        formData.append("text", text);
        formData.append("artType", artType);
        formData.append("tagId", tagId);
        formData.append("coverImg", coverImg);
        $.ajax({
            type: "POST",
            url: "/blog/add",
            data: formData,
            dataType: "text",
            processData: false,
            contentType: false,
            success: function (json) {
                if (json == "success") {
                    // layer.alert("æ·»åŠ åšå®¢æˆåŠŸ", {icon: 6}, function () {
                    //     //åˆ·æ–°device-list.htmlé¡µé¢
                    //     window.open("/blog/show", "_self")
                    // });
                    layer.confirm('æ·»åŠ åšå®¢æˆåŠŸ!', {
                        btn: ['æŸ¥çœ‹æ–‡ç« ', 'ç»§ç»­ç¼–è¾‘'] //æŒ‰é’®
                    }, function () {
                        window.open("/blog/show", "_self")
                    }, function () {
                        window.open("/blog/add", "_self")
                    });

                } else {
                    layer.msg('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ!', {icon: 5, time: 1000});

                }
            },
            error: function () {
                layer.msg('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ!', {icon: 5, time: 1000});

            }
        });

        return true;
    }

    /**
     * å°†æœ¬åœ°å›¾ç‰‡ æ˜¾ç¤ºåˆ°æµè§ˆå™¨ä¸Š
     */
    function preImg(sourceId, targetId) {
        var url = getFileUrl(sourceId);
        var imgPre = document.getElementById(targetId);
        imgPre.src = url;
    }

    /**
     * ä» file åŸŸè·å– æœ¬åœ°å›¾ç‰‡ url
     */
    function getFileUrl(sourceId) {
        var url;
        if (navigator.userAgent.indexOf("MSIE") >= 1) { // IE
            url = document.getElementById(sourceId).value;
        } else if (navigator.userAgent.indexOf("Firefox") > 0) { // Firefox
            url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
        } else if (navigator.userAgent.indexOf("Chrome") > 0) { // Chrome
            url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
        }
        return url;
    }

</script>
<!--è‡ªå®šä¹‰wangEditorçš„é«˜åº¦-->
<style>
    .w-e-text-container {
        height: 450px !important;
    }
</style>

</body>
</html>