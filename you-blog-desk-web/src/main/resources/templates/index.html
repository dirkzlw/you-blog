<!doctype html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="blog/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="blog/css/main.css" media="all">
    <link rel="stylesheet" href="blog/css/animate.css">
    <link rel="stylesheet" href="blog/css/font-icon.css">
    <!--返回顶部-->
    <link href="/back-to-top/css/style.css" rel="stylesheet" type="text/css"/>
    <title>个人博客</title>
</head>
<body>
<!--头部-->
<div th:replace="~{fragments/header :: header}"></div>

<!--内容-->
<div class="container mt-3">
    <div class="row">
        <div class="col-md-8">
            <div class="container">
                <!--轮播图-->
                <div class="row wow fadeInDown">
                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                        <ol class="carousel-indicators">
                            <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                        </ol>
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="blog/images/banner_1.jpg" class="d-block w-100" alt="...">
                            </div>
                            <div class="carousel-item">
                                <img src="blog/images/banner_2.jpg" class="d-block w-100" alt="...">
                            </div>
                            <div class="carousel-item">
                                <img src="blog/images/banner_3.jpg" class="d-block w-100" alt="...">
                            </div>
                        </div>
                        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button"
                           data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button"
                           data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <!--文章列表 头部-->
                <div class="row mt-2 wow fadeInDown">
                    <div class="col-md-12 bgc">
                        <div class="new">
                            <span><i class="el-certificate"></i></span>

                            <span>最新文章</span>
                            <small>New Article</small>
                        </div>
                    </div>
                </div>
                <!--文章列表 内容-->
                <div class="row mt-2 " id="blog-content">

                    <ul class="list-unstyled art-list" th:each="blog,var : ${blogPage.content}">
                        <li th:if="${var.count} % 2 eq 1 "
                            class="media wow bounceInLeft" data-wow-duration="1s" data-wow-delay="0.5s">
                            <div class="art-img">
                                <img class="mr-3" th:src="${blog.coverImgUrl}" alt="Generic placeholder image">
                            </div>
                            <div class="media-body art-content">
                                <h5 class="mt-0 mb-1"><a th:id="${blog.blogId}"
                                                         th:text="${blog.title}"
                                                         onclick="showBlog(this.id)"></a></h5>
                                <p th:text="${blog.text}"></p>
                                <ul>
                                    <li><a><i class="el-time"></i><span th:text="${blog.createTime}"></span></a></li>
                                    <li class="d-none d-sm-none d-md-none d-lg-block">
                                        <a href="./article.html"><i class="el-user"></i>
                                            <span th:text="${blog.user.username}"></span></a></li>
                                    <li><a><i class="el-heart"></i><span th:text="${blog.zanNum}"></span></a></li>
                                    <li><a><i class="el-eye-open"></i><span th:text="${blog.viewNum}"></span></a></li>
                                    <li class="d-none d-sm-none d-md-none d-lg-block">
                                        <a href="./article.html" ><i
                                                class="el-th-list"></i><span th:text="${blog.tag.type}"></span></a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li th:if="${var.count} % 2 eq 0 "
                            class="media wow bounceInRight" data-wow-duration="1s" data-wow-delay="0.5s">
                            <div class="art-img">
                                <img class="mr-3" th:src="${blog.coverImgUrl}" alt="Generic placeholder image">
                            </div>
                            <div class="media-body art-content">
                                <h5 class="mt-0 mb-1"><a th:id="${blog.blogId}"
                                                         th:text="${blog.title}"
                                                         onclick="showBlog(this.id)"></a></h5>
                                <p th:text="${blog.text}"></p>
                                <ul>
                                    <li><a><i class="el-time"></i><span th:text="${blog.createTime}"></span></a></li>
                                    <li class="d-none d-sm-none d-md-none d-lg-block">
                                        <a href="./article.html"><i class="el-user"></i>
                                            <span th:text="${blog.user.username}"></span></a></li>
                                    <li><a><i class="el-heart"></i><span th:text="${blog.zanNum}"></span></a></li>
                                    <li><a><i class="el-eye-open"></i><span th:text="${blog.viewNum}"></span></a></li>
                                    <li class="d-none d-sm-none d-md-none d-lg-block"><a
                                            href="/index/article/index/id/32.html" ><i
                                            class="el-th-list"></i><span th:text="${blog.tag.type}"></span></a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="row" id="bottom"></div>
            </div>
        </div>

        <!--右边-->
        <div th:replace="~{fragments/right :: right}"></div>
    </div>

    <!--返回顶部-->
    <div class="suspension">
        <a class="consult" target="_blank" title="在线客服">
            <div class="suspension-list" style="display:none;">
                <div class="suspension-list-content">
                    <ul>
                        <li>
                            <div href="javascript:;" class="service-phone">
                                <span class="info-name">客服热线</span>
                                <span class="info-value">400-888-8888</span>
                            </div>
                        </li>
                        <li>
                            <div href="javascript:;" class="service-qq">
                                <span class="info-name">在线客服</span>
                                <span class="info-value">800991234</span>
                            </div>
                        </li>
                        <li class="suspension-list-bottom">
                            <div href="javascript:;" class="service-proposal">
                                <span class="info-name">投诉与建议</span>
                                <span class="info-value">最快10分钟内回应</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </a>
        <a class="cart" title="关注微信公众号">
            <div class="pic">
                <div class="pic-content"
                     th:style="'background:url(' + ${session.attentionImgUrl} + ') center no-repeat ;background-size :139px 169px;'"></div>
            </div>
        </a>
        <a href="javascript:void(0)" onclick="toTop()" class="back-top" style="display: block;" title="返回顶部"></a>
    </div>
</div>

<!--隐藏的input-->
<input type="hidden" id="page" th:value="${blogPage.page}">
<input type="hidden" id="pageSize" th:value="${blogPage.pageSize}">
<input type="hidden" id="totalElements" th:value="${blogPage.totalElements}">

<!--底部-->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="blog/lib/jquery/jquery.js"></script>
<script src="blog/lib/bootstrap/js/bootstrap.js"></script>
<script src="blog/js/wow.js"></script>
<script type="text/javascript">

    /**
     * 展示某博客
     */
    function showBlog(id) {
        window.open("/blog/show?blogId=" + id, "_self");
    }

    /**
     * 监听滚动条
     */
    $(window).scroll(function () {
        //滚动条所在位置的高度
        totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
        //当前文档高度   小于或等于   滚动条所在位置高度  则是页面底部
        if (($(document).height()) <= totalheight + 1) {
            //滚动条到底加载新的数据
            var search = $("#search").val();
            var page = $("#page").val() * 1.0 + 1;
            $.ajax({
                type: "POST",
                url: "/blog/more",
                data: {'page': page, 'search': search},
                dataType: "text",
                success: function (json) {
                    //解析json
                    json = eval('(' + json + ')');
                    var content = json.content;
                    var page = json.page;
                    if (content.length == 0){
                        var totalElements = Number($("#totalElements").val());
                        var pageSize = Number($("#pageSize").val());
                        if(Math.ceil(totalElements/pageSize) == page){
                            //底部代码
                            var htmlStr = "<div class='col-md-12 bgc'>" +
                                "                        <div class='new'>" +
                                "                            <span><i class='el-certificate'></i>已经到底了~</span>" +
                                "                        </div>" +
                                "                    </div>";
                            $("#bottom").html(htmlStr);
                        }
                        return;
                    }
                    //拼接html
                    var htmlUl1 = "<ul class='list-unstyled art-list'>";
                    var htmlUl2 = "</ul>";
                    for (var i = 0; i < content.length; i+=2) {
                        var htmlStr = "                        <li class='media wow bounceInLeft' data-wow-duration='1s' data-wow-delay='0.5s'>" +
                            "                            <div class='art-img'>" +
                            "                                <img class='mr-3' src=" + content[i].coverImgUrl + " alt='Generic placeholder image'>" +
                            "                            </div>" +
                            "                            <div class='media-body art-content'>" +
                            "                                <h5 class='mt-0 mb-1'><a href='#' id='" + content[i].blogId + "' onclick='showBlog(this.id)'>" + content[i].title + "</a></h5>" +
                            "                                <p>" + content[i].text + "</p>" +
                            "                                <ul>" +
                            "                                    <li><a><i class='el-time'></i><span>" + content[i].createTime + "</span></a></li>" +
                            "                                    <li class='d-none d-sm-none d-md-none d-lg-block'>" +
                            "                                        <a href='#'><i class='el-user'></i>" +
                            "                                            <span>" + content[i].username + "</span></a></li>" +
                            "                                    <li><a><i class='el-heart'></i><span>" + content[i].zanNum + "</span></a></li>" +
                            "                                    <li><a><i class='el-eye-open'></i><span>" + content[i].viewNum + "</span></a></li>" +
                            "                                    <li class='d-none d-sm-none d-md-none d-lg-block'>" +
                            "                                        <a href='#' title='查看分类'><i" +
                            "                                                class='el-th-list'></i><span>" + content[i].tag + "</span></a></li>" +
                            "                                </ul>" +
                            "                            </div>" +
                            "                        </li>";
                        if (i + 1 < content.length) {
                            htmlStr += "                        <li class='media wow bounceInRight' data-wow-duration='1s' data-wow-delay='0.5s'>" +
                                "                            <div class='art-img'>" +
                                "                                <img class='mr-3' src=" + content[i+1].coverImgUrl + " alt='Generic placeholder image'>" +
                                "                            </div>" +
                                "                            <div class='media-body art-content'>" +
                                "                                <h5 class='mt-0 mb-1'><a href='#' id='" + content[i+1].blogId + "' onclick='showBlog(this.id)'>" + content[i+1].title + "</a></h5>" +
                                "                                <p>" + content[i+1].text + "</p>" +
                                "                                <ul>" +
                                "                                    <li><a><i class='el-time'></i><span>" + content[i+1].createTime + "</span></a></li>" +
                                "                                    <li class='d-none d-sm-none d-md-none d-lg-block'>" +
                                "                                        <a href='#'><i class='el-user'></i>" +
                                "                                            <span>" + content[i+1].username + "</span></a></li>" +
                                "                                    <li><a><i class='el-heart'></i><span>" + content[i+1].zanNum + "</span></a></li>" +
                                "                                    <li><a><i class='el-eye-open'></i><span>" + content[i+1].viewNum + "</span></a></li>" +
                                "                                    <li class='d-none d-sm-none d-md-none d-lg-block'>" +
                                "                                        <a href='#' title='查看分类'><i" +
                                "                                                class='el-th-list'></i><span>" + content[i+1].tag + "</span></a></li>" +
                                "                                </ul>" +
                                "                            </div>" +
                                "                        </li>"
                        }
                        $("#blog-content").append(htmlUl1 + htmlStr + htmlUl2);
                    }
                    $("#page").attr("value", page);
                },
                error: function () {
                    layer.msg('添加失败，请检查网络!', {icon: 5, time: 1000});

                }
            });
        }
    });

    /**
     * 监听返回顶部
     */
    $(function () {
        $(".back-top").hide();
        $(window).bind('scroll resize', function () {
            if ($(window).scrollTop() <= 400) {
                $(".back-top").hide();
            } else {
                $(".back-top").show();
            }
        })
    });

    //回到顶部
    function toTop() {
        $('html, body').animate({
            scrollTop: 0
        }, 400);
        return false;
    }
</script>
<script>
    new WOW().init();//把wow初始化
</script>
</body>
</html>